=pod

=encoding utf8

=head1 NAME

TXN - Double-entry bookkeeping transaction journal parser and serializer
(mktxn)

=head1 SYNOPSIS

cmdline:

  $ mktxn \
      --name="txnjrnl" \
      --version="1.0.0" \
      --release=1 \
      --description="My transactions" \
      sample.txn

  $ mktxn -m=json serialize path/to/transaction/journal

perl6:

  use TXN;
  my $file = 'sample.txn';
  my @txn = from-txn(:$file);
  my $json = from-txn(:$file, :json);

=head1 DESCRIPTION

Parses transaction journals with syntax inspired
by L<@mafm|https://github.com/mafm>'s work in
L<@ledger.py|https://github.com/mafm/ledger.py>, e.g.:

  2013-01-15 I paid my electricity bill.
    Expenses:Electricity        $280.42
    Assets:Bankwest:Cheque     -$280.42

Serializes to JSON or Perlish object representation.

=head2 Release Mode

In release mode, mktxn produces a tarball comprised of two JSON files:

=head3 .TXNINFO

Inspired by Arch .PKGINFO files, .TXNINFO files contain transaction
journal metadata useful in simple queries.

    {
      compiler: "mktxn 0.0.1 2015-10-12T20:48:23Z",
      name: "mysamplejrnl",
      version: "0.1.9",
      release: "1",
      owner: "",
      description: "",
      config: {
        profile-name: "first",
        ...
      },
      count: 7,
      count-involving-aux-assets: 2,
      count-involving-aux-assets-xe-missing: 1,
      entities-seen: ["Entity", "Names", "Go", "Here"]
    }

=head3 txn.json

txn.json contains the output of serializing the transaction journal to JSON.

    [
      {
        "drift": 0,
        "entity": "VarName",
        "entry_id": {
          "number": 0,
          "xxhash": 5555555,
          "text": "capture entry"
        },
        "mod_holdings": {
          "AssetCode": {
            "entity": "VarName",
            "asset_code": "AssetCode",
            "asset_flow": "AssetFlow",
            "costing": "Costing",
            "date": "DateTime",
            "price": 5.55,
            "acquisition_price_asset_code": "AssetCode",
            "quantity": 5.5555555
          }
        },
        "mod_wallet": [
          {
            "silo": "SILO",
            "entity": "VarName",
            "subwallet": [ "VarName" ],
            "asset_code": "AssetCode",
            "decinc": "DecInc",
            "quantity": 5.5555555,
            "xe_asset_code": "",
            "xe_asset_quantity": "",
            "entry_id": {
              "number": 0,
              "xxhash": 5555555,
              "text": "capture entry"
            },
            "posting_id": {
              "entry_id": {
                "number": 0,
                "xxhash": 5555555,
                "text": "capture entry"
              },
              "number": 0,
              "xxhash": 55555557,
              "text": "capture posting"
            }
          }
        ]
      }
    ]

.TXNINFO and txn.json are compressed and saved as filename
C<$pkgname-$pkgver-$pkgrel.txn.tar.xz> in the current working directory.

=head1 INSTALLATION

=head2 Dependencies

=over

=item Rakudo Perl 6

=item L<Digest::xxHash|https://github.com/atweiden/digest-xxhash>

=item L<JSON::Tiny|https://github.com/moritz/json>

=back

=head1 LICENSE

This is free and unencumbered public domain software. For more
information, see http://unlicense.org/ or the accompanying UNLICENSE file.
